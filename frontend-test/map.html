<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Puntos de Reciclaje - ReusoSmart</title>
  <style>
    #map {
      height: 90vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Puntos de Reciclaje Eléctricos y Electrónicos</h1>
  <div id="map"></div>

  <script>
    let map;

    async function initMap() {
      // Inicializamos el mapa centrado en Santiago
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -33.45, lng: -70.6667 },
        zoom: 6,
      });

      try {
        const res = await fetch("http://localhost:5000/api/points");
        const points = await res.json();

        points.forEach(point => {
          const marker = new google.maps.Marker({
            position: { lat: point.lat, lng: point.lng },
            map: map,
            title: point.name,
            icon: point.type === "eléctrico" ? "http://maps.google.com/mapfiles/ms/icons/green-dot.png" : "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `<h3>${point.name}</h3><p>${point.description}</p><p>Tipo: ${point.type}</p>`
          });

          marker.addListener("click", () => {
            infoWindow.open(map, marker);
          });
        });

      } catch (error) {
        console.error("Error al cargar los puntos:", error);
        alert("No se pudieron cargar los puntos de reciclaje.");
      }
    }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=TU_API_KEY&callback=initMap" async defer></script>
</body>
</html>
